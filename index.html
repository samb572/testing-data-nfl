<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL WR Reception Betting Model</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            background-attachment: fixed;
            color: #ffffff;
            padding: 20px;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),
                linear-gradient(45deg, rgba(59, 130, 246, 0.01) 0%, transparent 25%, rgba(99, 102, 241, 0.01) 50%, transparent 75%);
            z-index: -2;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(59, 130, 246, 0.01) 2px,
                    rgba(59, 130, 246, 0.01) 4px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(99, 102, 241, 0.01) 2px,
                    rgba(99, 102, 241, 0.01) 4px
                );
            z-index: -1;
        }
        
        /* Password Screen Styles */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .password-container {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.95) 0%, rgba(31, 41, 55, 0.9) 100%);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                0 0 40px rgba(59, 130, 246, 0.05);
            backdrop-filter: blur(15px);
            text-align: center;
            max-width: 400px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .password-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, #3b82f6, #6366f1, #3b82f6);
            background-size: 200% 200%;
            border-radius: 20px;
            z-index: -1;
            opacity: 0.5;
            animation: borderGlow 3s ease-in-out infinite;
        }
        
        .password-title {
            color: #3b82f6;
            font-size: 2rem;
            font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .password-subtitle {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        .password-input-group {
            margin-bottom: 20px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            background-color: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            color: #ffffff;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }
        
        .password-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .password-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .password-submit:active {
            transform: translateY(0);
        }
        
        .password-error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 15px;
            display: none;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .main-content {
            display: none;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #ffffff;
            margin-bottom: 40px;
            font-size: 3.5rem;
            font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
            font-weight: 800;
            letter-spacing: -1px;
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            animation: titleFade 2s ease-in-out infinite alternate;
        }
        
        @keyframes titleFade {
            0% {
                opacity: 0.8;
                filter: brightness(1);
            }
            100% {
                opacity: 1;
                filter: brightness(1.1);
            }
        }
        
        h1::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -30px;
            width: 20px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            transform: translateY(-50%);
        }
        
        h1::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -30px;
            width: 20px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #6366f1, transparent);
            transform: translateY(-50%);
        }
        
        .formula-display {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.9) 0%, rgba(31, 41, 55, 0.8) 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .formula-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.05), transparent);
            animation: scan 3s infinite;
        }
        
        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .formula-display h3 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .formula {
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.8;
            overflow-x: auto;
            background-color: rgba(15, 23, 42, 0.6);
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            color: #cbd5e1;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.9) 0%, rgba(31, 41, 55, 0.8) 100%);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(99, 102, 241, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }
        
        .input-section:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .input-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(59, 130, 246, 0.05), rgba(99, 102, 241, 0.05));
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }
        
        .input-section:hover::before {
            opacity: 1;
        }
        
        .input-section h3 {
            color: #6366f1;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .input-group {
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #94a3b8;
            font-size: 14px;
        }
        
        input[type="number"], input[type="text"], select { /* Added input[type="text"] */
            width: 100%;
            padding: 12px;
            background-color: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 8px;
            color: #ffffff;
            font-size: 16px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus, input[type="text"]:focus, select:focus { /* Added input[type="text"] */
            outline: none;
            border-color: #3b82f6;
            background-color: rgba(15, 23, 42, 0.8);
        }
        
        .calculate-btn, .load-data-btn { /* Added .load-data-btn */
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            margin-bottom: 15px; /* Added margin for separation */
        }
        
        .calculate-btn::before, .load-data-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease-in-out;
        }
        
        .calculate-btn:hover, .load-data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            animation: buttonPulse 1.5s ease-in-out infinite;
        }
        
        .calculate-btn:hover::before, .load-data-btn:hover::before {
            left: 100%;
        }
        
        .calculate-btn:active, .load-data-btn:active {
            transform: translateY(0);
        }
        
        @keyframes buttonPulse {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            }
            50% { 
                box-shadow: 0 12px 35px rgba(59, 130, 246, 0.5);
            }
        }
        
        .results {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.95) 0%, rgba(31, 41, 55, 0.9) 100%);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            position: relative;
        }
        
        .results::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, #3b82f6, #6366f1, #3b82f6);
            background-size: 200% 200%;
            border-radius: 20px;
            z-index: -1;
            opacity: 0.3;
            animation: borderGlow 3s ease-in-out infinite;
        }
        
        @keyframes borderGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #94a3b8;
        }
        
        .result-value {
            font-size: 20px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .score-interpretation {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .score-high {
            background-color: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }
        
        .score-medium {
            background-color: rgba(250, 204, 21, 0.1);
            border: 1px solid rgba(250, 204, 21, 0.3);
            color: #facc15;
        }
        
        .score-low {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        .info-text {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }
        
        .game-context-scale {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            font-size: 12px;
            color: #94a3b8;
        }
        
        .component-chart {
            margin-top: 20px;
            padding: 20px;
            background-color: rgba(15, 23, 42, 0.6);
            border-radius: 10px;
        }
        
        .bar-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            margin-bottom: 10px;
        }
        
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .bar {
            width: 100%;
            max-width: 60px;
            background-color: #3b82f6;
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
            font-size: 14px;
            color: #e2e8f0;
        }
        
        .bar-label {
            margin-top: 10px;
            font-size: 12px;
            text-align: center;
            color: #94a3b8;
        }
        
        .penalty-indicator {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            font-size: 14px;
            color: #ef4444;
        }
        
        .coverage-impact {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .coverage-high {
            background-color: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }
        
        .coverage-medium {
            background-color: rgba(250, 204, 21, 0.1);
            border: 1px solid rgba(250, 204, 21, 0.3);
            color: #facc15;
        }
        
        .coverage-low {
            background-color: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #818cf8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
                margin-bottom: 20px;
            }
            
            h1::before, h1::after {
                display: none;
            }
            
            .password-container {
                padding: 30px 20px;
            }
            
            .password-title {
                font-size: 1.5rem;
            }
            
            .formula-display {
                padding: 15px;
            }
            
            .formula {
                font-size: 11px;
                padding: 10px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .input-section {
                padding: 15px;
            }
            
            .input-section:hover {
                transform: none;
            }
            
            .calculate-btn, .load-data-btn {
                font-size: 16px;
                padding: 16px;
            }
            
            .calculate-btn:hover, .load-data-btn:hover {
                transform: translateY(-1px);
            }
            
            .results {
                padding: 20px;
            }
            
            .bar-container {
                height: 150px;
            }
            
            .bar {
                max-width: 40px;
            }
            
            .bar-value {
                font-size: 12px;
                top: -20px;
            }
            
            .bar-label {
                font-size: 10px;
            }
            
            .result-value {
                font-size: 16px;
            }
            
            #finalScore {
                font-size: 24px !important;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .formula {
                font-size: 10px;
            }
            
            .input-section h3 {
                font-size: 1rem;
            }
            
            .calculate-btn {
                font-size: 14px;
                padding: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-container">
            <h2 class="password-title">Access Required</h2>
            <p class="password-subtitle">Enter password to access the betting model</p>
            <div class="password-input-group">
                <input type="password" class="password-input" id="passwordInput" placeholder="Enter Password" autocomplete="off">
            </div>
            <button class="password-submit" onclick="checkPassword()">UNLOCK</button>
            <div class="password-error" id="passwordError">Incorrect password. Please try again.</div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="container">
            <h1>NFL WR Reception Betting Model</h1>
            
            <div class="formula-display">
                <h3>Enhanced Formula with Coverage Frequency Weighting</h3>
                <div class="formula">
Base Score = 
  (0.35 × Coverage_Adj_TPRR²) + 
  (0.25 × Normalized_Sep_Score²) + 
  (0.20 × Volume_Factor) + 
  (0.15 × Matchup_Factor) + 
  (0.10 × Game_Context_Factor)

Final Score = Base Score × TPRR_Quality_Multiplier

Where:
- Coverage_Adj_TPRR = Weighted_TPRR² with coverage frequency adjustments
- Weighted_TPRR = (TPRR_vs_Coverage × Coverage_Weight) + (Est_Base_TPRR × (1 - Coverage_Weight))
- Coverage_Weight = Adjusted based on frequency (high impact ≥35%, low impact <15%)
- Est_Base_TPRR = Target_Share × 0.85 (assuming 85% route participation)
- Normalized_Sep_Score = (Sep_Score / 0.25) × 10  [Squared, 0.25 as baseline]
- Volume_Factor = (Target_Share × Routes_Per_Game) / 100
- Matchup_Factor = Max(0, (Def_TPRR - 18) + (Def_Catch_Rate - 60)) / 2
- Game_Context_Factor = (Game_Flow - 1) × 25  [0-100 scale]
- TPRR_Quality_Multiplier = 0.75 if TPRR < 20%, else 1.0</div>
            </div>
            
            <div class="input-grid">
                <div class="input-section">
                    <h3>Lookup Player/Matchup</h3>
                    <div class="input-group">
                        <label for="playerNameInput">Player Name</label>
                        <input type="text" id="playerNameInput" placeholder="e.g., Ja'Marr Chase">
                    </div>
                    <div class="input-group">
                        <label for="playerTeamInput">Player's Team (3-letter abbreviation)</label>
                        <input type="text" id="playerTeamInput" placeholder="e.g., CIN">
                    </div>
                    <div class="input-group">
                        <label for="opponentTeamInput">Opponent Team (3-letter abbreviation)</label>
                        <input type="text" id="opponentTeamInput" placeholder="e.g., JAX">
                    </div>
                    <div class="input-group">
                        <label for="seasonInput">Season (Year)</label>
                        <input type="number" id="seasonInput" value="2024" min="2000" max="2030">
                    </div>
                    <button class="load-data-btn" onclick="loadPlayerAndMatchupData()">Load Player & Matchup Data</button>
                    <div id="loadingStatus" style="color: #facc15; font-size: 14px; text-align: center; margin-top: 10px; display: none;">Loading...</div>
                    <div id="errorStatus" style="color: #ef4444; font-size: 14px; text-align: center; margin-top: 10px; display: none;"></div>
                </div>

                <div class="input-section">
                    <h3>Player Metrics (Auto-filled or Manual)</h3>
                    <div class="input-group">
                        <label for="tprr">TPRR vs Coverage Type (%)</label>
                        <input type="number" id="tprr" placeholder="e.g., 28.5" step="0.1" min="0" max="100">
                        <div class="info-text">Target Per Route Run against specific coverage</div>
                    </div>
                    <div class="input-group">
                        <label for="sepScore">Separation Score (0-1)</label>
                        <input type="number" id="sepScore" placeholder="e.g., 0.25" step="0.01" min="0" max="1">
                        <div class="info-text">0.3+ is elite, 0.2-0.3 is good, below 0.2 is poor</div>
                    </div>
                    <div class="input-group">
                        <label for="targetShare">Target Share (%)</label>
                        <input type="number" id="targetShare" placeholder="e.g., 24.5" step="0.1" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="routesPerGame">Routes Per Game</label>
                        <input type="number" id="routesPerGame" placeholder="e.g., 35" step="1" min="0">
                    </div>
                </div>
                
                <div class="input-section">
                    <h3>Game Context & Defensive Metrics (Auto-filled or Manual)</h3>
                    <div class="input-group">
                        <label for="gameFlow">Expected Game Flow (1-5)</label>
                        <select id="gameFlow">
                            <option value="">Select game flow scenario</option>
                            <option value="1">1 - Heavy favorite (blowout win, low volume)</option>
                            <option value="2">2 - Slight favorite (competitive, less passing)</option>
                            <option value="3">3 - Even matchup (neutral game script)</option>
                            <option value="4">4 - Slight underdog (trailing, more passing)</option>
                            <option value="5">5 - Heavy underdog (blowout loss, high volume)</option>
                        </select>
                        <div class="game-context-scale">
                            <strong>Scale Guide:</strong><br>
                            1 = Team favored by 14+ (run-heavy script expected)<br>
                            2 = Team favored by 7-13 (balanced approach)<br>
                            3 = Line within 6.5 points (neutral script)<br>
                            4 = Team underdog by 7-13 (pass-heavy likely)<br>
                            5 = Team underdog by 14+ (garbage time volume)
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="coverageFreq">Defense Coverage Frequency (%)</label>
                        <input type="number" id="coverageFreq" placeholder="e.g., 35" step="0.1" min="0" max="100">
                        <div class="info-text">How often defense runs this specific coverage type</div>
                    </div>
                    <div class="input-group">
                        <label for="defTPRR">Defense TPRR Allowed (%)</label>
                        <input type="number" id="defTPRR" placeholder="e.g., 22.3" step="0.1" min="0" max="100">
                        <div class="info-text">How often defense allows targets (league avg ~18.5%)</div>
                    </div>
                    <div class="input-group">
                        <label for="defCatchRate">Defense Catch Rate Allowed (%)</label>
                        <input type="number" id="defCatchRate" placeholder="e.g., 65.4" step="0.1" min="0" max="100">
                        <div class="info-text">Completion % allowed (league avg ~63%)</div>
                    </div>
                    <div class="input-group">
                        <label for="projectedLine">Projected Reception Line</label>
                        <input type="number" id="projectedLine" placeholder="e.g., 5.5" step="0.5" min="0">
                        <div class="info-text">Sportsbook O/U line</div>
                    </div>
                </div>
            </div>
            
            <button class="calculate-btn" onclick="calculateScore()" ontouchstart="">Calculate Reception Score</button>
            
            <div class="results" id="results" style="display: none; margin-top: 30px;">
                <h3 style="color: #3b82f6; margin-bottom: 20px;">Analysis Results</h3>
                
                <div class="component-chart">
                    <div class="bar-container" id="barChart"></div>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Coverage Adjusted TPRR (squared)</span>
                    <span class="result-value" id="coverageAdjTPRR">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Normalized Separation (squared)</span>
                    <span class="result-value" id="normalizedSep">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Volume Factor</span>
                    <span class="result-value" id="volumeFactor">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Matchup Factor</span>
                    <span class="result-value" id="matchupFactor">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Game Context Factor</span>
                    <span class="result-value" id="gameContextFactor">-</span>
                </div>
                <div id="coverageImpact" class="coverage-impact" style="display: none;"></div>
                <div id="penaltyIndicator" class="penalty-indicator" style="display: none;"></div>
                <div class="result-item" style="margin-top: 10px; padding-top: 20px; border-top: 2px solid #3b82f6;">
                    <span class="result-label" style="font-size: 18px;">Final Reception Score</span>
                    <span class="result-value" id="finalScore" style="font-size: 28px; color: #3b82f6;">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Expected Receptions</span>
                    <span class="result-value" id="expectedReceptions">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">vs. Projected Line</span>
                    <span class="result-value" id="lineComparison">-</span>
                </div>
                <div class="score-interpretation" id="interpretation"></div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Client Initialization (replace with your actual URL and Key)
        // IMPORTANT: Use your SUPABASE_URL and SUPABASE_KEY here (the public/anon key)
        const SUPABASE_URL = 'https://pyjtwdgapmbdgtpflzan.supabase.co'; //
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5anR3ZGdhcG1iZGd0cGZsemFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTEzNTgsImV4cCI6MjA2NjcyNzM1OH0._Bt_XomEPAYRqC6zNgkNDwq66XFlpMoPbNMB6Eb4USo'; //

        const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Password check function
        function checkPassword() {
            const passwordInput = document.getElementById('passwordInput');
            const password = passwordInput.value;
            const correctPassword = 'BALLSTICK'; // Keep this secure in a real app

            if (password === correctPassword) {
                document.getElementById('passwordOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            } else {
                document.getElementById('passwordError').style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
                setTimeout(() => {
                    document.getElementById('passwordError').style.display = 'none';
                }, 3000);
            }
        }

        // Allow Enter key to submit password
        document.getElementById('passwordInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });
        
        // Focus on password input when page loads
        window.onload = function() {
            document.getElementById('passwordInput').focus();
        };

        // --- NEW SUPABASE INTEGRATION FUNCTIONS ---

        async function loadPlayerAndMatchupData() {
            const playerName = document.getElementById('playerNameInput').value.trim();
            const playerTeam = document.getElementById('playerTeamInput').value.trim().toUpperCase();
            const opponentTeam = document.getElementById('opponentTeamInput').value.trim().toUpperCase();
            const season = parseInt(document.getElementById('seasonInput').value);

            const loadingStatusDiv = document.getElementById('loadingStatus');
            const errorStatusDiv = document.getElementById('errorStatus');
            loadingStatusDiv.style.display = 'block';
            errorStatusDiv.style.display = 'none';
            errorStatusDiv.textContent = '';

            if (!playerName || !playerTeam || !opponentTeam || !season) {
                errorStatusDiv.textContent = 'Please fill in Player Name, Player Team, Opponent Team, and Season.';
                errorStatusDiv.style.display = 'block';
                loadingStatusDiv.style.display = 'none';
                return;
            }

            try {
                // 1. Get Opponent's Coverage Frequencies to find the most frequent one
                const { data: defCoverageFreqData, error: defCoverageFreqError } = await supabase
                    .from('defensive_coverages')
                    .select('man_pct, cover_0_pct, cover_1_pct, cover_2_pct, cover_2_man_pct, cover_3_pct, cover_4_pct, cover_6_pct, zone_pct')
                    .eq('team_name', opponentTeam)
                    .eq('season', season)
                    .single();

                if (defCoverageFreqError) {
                    throw new Error(`Error fetching defensive coverage frequencies: ${defCoverageFreqError.message}`);
                }
                if (!defCoverageFreqData) {
                    throw new Error(`No coverage frequency data found for ${opponentTeam} in ${season}.`);
                }

                // Determine the most frequent coverage type
                const coverageTypes = [
                    { name: 'Man Coverage', pct: defCoverageFreqData.man_pct },
                    { name: 'Cover 0', pct: defCoverageFreqData.cover_0_pct },
                    { name: 'Cover 1', pct: defCoverageFreqData.cover_1_pct },
                    { name: 'Cover 2', pct: defCoverageFreqData.cover_2_pct },
                    { name: 'Cover 2 Man', pct: defCoverageFreqData.cover_2_man_pct },
                    { name: 'Cover 3', pct: defCoverageFreqData.cover_3_pct },
                    { name: 'Cover 4', pct: defCoverageFreqData.cover_4_pct },
                    { name: 'Cover 6', pct: defCoverageFreqData.cover_6_pct }
                ];
                
                // Filter out null/undefined percentages and find the max
                const validCoverages = coverageTypes.filter(c => typeof c.pct === 'number' && c.pct !== null);
                let mostFrequentCoverage = 'Overall'; // Default to overall if no specific match
                let maxFreq = 0;

                if (validCoverages.length > 0) {
                    const sortedCoverages = validCoverages.sort((a, b) => b.pct - a.pct);
                    mostFrequentCoverage = sortedCoverages[0].name;
                    maxFreq = sortedCoverages[0].pct;
                } else {
                    console.warn("No valid coverage frequencies found for opponent team. Defaulting to 'Overall'.");
                }
                
                document.getElementById('coverageFreq').value = maxFreq || 0; // Set the percentage for the most frequent coverage

                console.log(`Most frequent coverage for ${opponentTeam} in ${season}: ${mostFrequentCoverage} (${maxFreq}%)`);


                // 2. Get Player Stats for the determined coverage type AND Overall for Target Share
                const { data: playerStatsOverallData, error: playerStatsOverallError } = await supabase
                    .from('player_cover_stats')
                    .select('tprr_player')
                    .eq('player_name', playerName)
                    .eq('team', playerTeam)
                    .eq('season', season)
                    .eq('coverage_type', 'Overall') // Fetch Overall TPRR for Target Share
                    .single();

                if (playerStatsOverallError) {
                    console.warn(`Error fetching overall player stats for target share: ${playerStatsOverallError.message}. Defaulting Target Share to 0.`);
                    document.getElementById('targetShare').value = 0; // Default if overall not found
                } else if (playerStatsOverallData && playerStatsOverallData.tprr_player !== null) {
                    document.getElementById('targetShare').value = (playerStatsOverallData.tprr_player * 100).toFixed(1);
                } else {
                    document.getElementById('targetShare').value = 0;
                    console.warn(`No overall player data found for target share for ${playerName} in ${season}. Defaulting Target Share to 0.`);
                }

                // Get Player Stats for the MOST FREQUENT coverage type
                const { data: playerStatsCoverageData, error: playerStatsCoverageError } = await supabase
                    .from('player_cover_stats')
                    .select('tprr_player, separation_score')
                    .eq('player_name', playerName)
                    .eq('team', playerTeam)
                    .eq('season', season)
                    .eq('coverage_type', mostFrequentCoverage) // Fetch based on most frequent coverage
                    .single();

                if (playerStatsCoverageError) {
                    throw new Error(`Error fetching player stats for ${mostFrequentCoverage}: ${playerStatsCoverageError.message}`);
                }
                if (!playerStatsCoverageData) {
                    throw new Error(`No player data found for ${playerName} vs ${mostFrequentCoverage} in ${season}.`);
                }

                // Set player metrics inputs
                document.getElementById('tprr').value = (playerStatsCoverageData.tprr_player * 100).toFixed(1); // Convert to percentage
                document.getElementById('sepScore').value = (playerStatsCoverageData.separation_score !== null) ? playerStatsCoverageData.separation_score.toFixed(3) : 0; // Handle potential nulls
                // routesPerGame remains manual


                // 3. Get Defensive Matchup Stats for the determined coverage type
                const { data: defMatchupData, error: defMatchupError } = await supabase
                    .from('defensive_matchups')
                    .select('tprr_allowed, catch_rate_allowed')
                    .eq('defensive_team_name', opponentTeam)
                    .eq('season', season)
                    .eq('coverage_type', mostFrequentCoverage) // Fetch based on most frequent coverage
                    .single();

                if (defMatchupError) {
                    throw new Error(`Error fetching defensive matchup stats: ${defMatchupError.message}`);
                }
                if (!defMatchupData) {
                    throw new Error(`No defensive matchup data found for ${opponentTeam} vs ${mostFrequentCoverage} in ${season}.`);
                }

                // Set defensive metrics inputs
                document.getElementById('defTPRR').value = (defMatchupData.tprr_allowed * 100).toFixed(1); // Convert to percentage
                document.getElementById('defCatchRate').value = defMatchupData.catch_rate_allowed.toFixed(1);

                // gameFlow and projectedLine remain manual

                loadingStatusDiv.style.display = 'none';
                alert('Data loaded successfully! You can now calculate the score.');

            } catch (error) {
                console.error("Failed to load data:", error);
                errorStatusDiv.textContent = `Error: ${error.message}. Please check inputs and ensure data exists in Supabase.`;
                errorStatusDiv.style.display = 'block';
                loadingStatusDiv.style.display = 'none';
            }
        }
        
        function calculateScore() {
            // Get input values
            const tprr = parseFloat(document.getElementById('tprr').value) || 0;
            const sepScore = parseFloat(document.getElementById('sepScore').value) || 0;
            const targetShare = parseFloat(document.getElementById('targetShare').value) || 0;
            const routesPerGame = parseFloat(document.getElementById('routesPerGame').value) || 0;
            const gameFlow = parseFloat(document.getElementById('gameFlow').value) || 3;
            const coverageFreq = parseFloat(document.getElementById('coverageFreq').value) || 25; // Default 25%
            const defTPRR = parseFloat(document.getElementById('defTPRR').value) || 0;
            const defCatchRate = parseFloat(document.getElementById('defCatchRate').value) || 0;
            const projectedLine = parseFloat(document.getElementById('projectedLine').value) || 0;
            
            // Calculate coverage frequency weight and impact
            let coverageWeight = coverageFreq / 100;
            let coverageImpactText = "";
            let coverageImpactClass = "";
            
            if (coverageFreq >= 35) {
                // High impact - bonus for frequent favorable matchups
                coverageWeight = (coverageFreq / 100) * 1.2; // 20% bonus weight
                coverageImpactText = `High Coverage Impact (${coverageFreq}%) - Strong predictive value`;
                coverageImpactClass = "coverage-high";
            } else if (coverageFreq < 15) {
                // Low impact - significantly reduce weight
                coverageWeight = (coverageFreq / 100) * 0.4; // 60% penalty
                coverageImpactText = `Low Coverage Impact (${coverageFreq}%) - Limited predictive value`;
                coverageImpactClass = "coverage-low";
            } else {
                // Medium impact - normal weight
                coverageImpactText = `Medium Coverage Impact (${coverageFreq}%) - Moderate predictive value`;
                coverageImpactClass = "coverage-medium";
            }
            
            // Estimate base TPRR from target share
            const estimatedBaseTPRR = targetShare * 0.85; // Assuming 85% route participation
            
            // Calculate weighted TPRR
            const weightedTPRR = (tprr * coverageWeight) + (estimatedBaseTPRR * (1 - coverageWeight));
            
            // Coverage TPRR - using weighted value
            const coverageAdjBase = (weightedTPRR / 25) * 10;
            const coverageAdjTPRR = Math.pow(Math.min(coverageAdjBase, 12), 2);
            
            // Separation - squared with lower baseline
            const sepBase = (sepScore / 0.25) * 10;
            const normalizedSep = Math.pow(Math.min(sepBase, 12), 2);
            
            // Volume Factor - linear but capped
            const volumeFactor = Math.min((targetShare * routesPerGame) / 100, 100);
            
            // Matchup Factor - only positive for above-average defenses
            const defTPRRDiff = Math.max(0, defTPRR - 18.5);
            const defCatchDiff = Math.max(0, defCatchRate - 63);
            const matchupFactor = (defTPRRDiff + defCatchDiff) / 2;
            
            // Game Context - scaled from 0-100
            const gameContextFactor = (gameFlow - 1) * 25;
            
            // Calculate base score
            const baseScore = (0.35 * coverageAdjTPRR) + 
                            (0.25 * normalizedSep) + 
                            (0.20 * volumeFactor) + 
                            (0.15 * matchupFactor) + 
                            (0.10 * gameContextFactor);
            
            // Apply penalty for poor TPRR
            let qualityMultiplier = 1.0;
            let penaltyText = "";
            
            if (tprr < 20) {
                qualityMultiplier = 0.75;
                penaltyText = "Low TPRR penalty applied (-25%)";
            }
            
            const finalScore = baseScore * qualityMultiplier;
            
            // Adjust expected receptions based on game context
            const gameFlowMultiplier = 0.8 + (gameFlow * 0.1);
            const expectedReceptions = (routesPerGame * (weightedTPRR / 100) * (defCatchRate / 100) * gameFlowMultiplier).toFixed(1);
            
            // Update display
            document.getElementById('coverageAdjTPRR').textContent = coverageAdjTPRR.toFixed(1);
            document.getElementById('normalizedSep').textContent = normalizedSep.toFixed(1);
            document.getElementById('volumeFactor').textContent = volumeFactor.toFixed(1);
            document.getElementById('matchupFactor').textContent = matchupFactor.toFixed(1);
            document.getElementById('gameContextFactor').textContent = gameContextFactor.toFixed(1);
            document.getElementById('finalScore').textContent = finalScore.toFixed(1);
            document.getElementById('expectedReceptions').textContent = expectedReceptions;
            
            // Show coverage impact indicator
            const coverageImpactDiv = document.getElementById('coverageImpact');
            coverageImpactDiv.textContent = coverageImpactText;
            coverageImpactDiv.className = 'coverage-impact ' + coverageImpactClass;
            coverageImpactDiv.style.display = 'block';
            
            // Show penalty indicator if applicable
            const penaltyIndicator = document.getElementById('penaltyIndicator');
            if (penaltyText) {
                penaltyIndicator.textContent = penaltyText;
                penaltyIndicator.style.display = 'block';
            } else {
                penaltyIndicator.style.display = 'none';
            }
            
            // Create bar chart
            createBarChart({
                'Coverage TPRR': coverageAdjTPRR,
                'Separation': normalizedSep,
                'Volume': volumeFactor,
                'Matchup': matchupFactor,
                'Game Context': gameContextFactor
            });
            
            // Line comparison
            const lineDiff = parseFloat(expectedReceptions) - projectedLine;
            let lineCompText = '';
            if (lineDiff > 0) {
                lineCompText = `+${lineDiff.toFixed(1)} (OVER)`;
            } else {
                lineCompText = `${lineDiff.toFixed(1)} (UNDER)`;
            }
            document.getElementById('lineComparison').textContent = lineCompText;
            
            // Score interpretation
            let interpretation = '';
            let interpretClass = '';
            
            if (finalScore >= 80) {
                interpretation = 'EXCELLENT BET - Strong value, high confidence';
                interpretClass = 'score-high';
            } else if (finalScore >= 60) {
                interpretation = 'GOOD BET - Positive indicators, moderate confidence';
                interpretClass = 'score-medium';
            } else if (finalScore >= 40) {
                interpretation = 'NEUTRAL - Mixed signals, proceed with caution';
                interpretClass = 'score-medium';
            } else {
                interpretation = 'POOR BET - Negative indicators, avoid';
                interpretClass = 'score-low';
            }
            
            const interpretDiv = document.getElementById('interpretation');
            interpretDiv.textContent = interpretation;
            interpretDiv.className = 'score-interpretation ' + interpretClass;
            
            // Show results
            document.getElementById('results').style.display = 'block';
        }
        
        function createBarChart(data) {
            const barChart = document.getElementById('barChart');
            barChart.innerHTML = '';
            
            const maxValue = Math.max(...Object.values(data), 100); // Ensure a baseline of 100 for scaling
            
            for (const [label, value] of Object.entries(data)) {
                const barWrapper = document.createElement('div');
                barWrapper.className = 'bar-wrapper';
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = (value / maxValue) * 100;
                bar.style.height = height + '%';
                
                // Color based on value
                if (value >= 80) {
                    bar.style.backgroundColor = '#22c55e';
                } else if (value >= 40) {
                    bar.style.backgroundColor = '#facc15';
                } else {
                    bar.style.backgroundColor = '#ef4444';
                }
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = value.toFixed(1);
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = label;
                
                barWrapper.appendChild(bar);
                barWrapper.appendChild(barLabel);
                barChart.appendChild(barWrapper);
            }
        }
        
        // Add touch event support for mobile for calculate button
        document.addEventListener('DOMContentLoaded', function() {
            const calculateButton = document.querySelector('.calculate-btn');
            if (calculateButton) {
                calculateButton.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    calculateScore();
                }, { passive: false });
            }

            // Add touch event support for mobile for load data button
            const loadDataButton = document.querySelector('.load-data-btn');
            if (loadDataButton) {
                loadDataButton.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    loadPlayerAndMatchupData();
                }, { passive: false });
            }
        });
    </script>
</body>
</html>